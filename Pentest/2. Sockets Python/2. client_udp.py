'''
O protocolo UDP não tem a confirmação como o TCP (Three-way Handshake)
Os dados são enviados mas não tem confirmação de recebimento
'''
import socket

# SOCK_DGRAM para protocolo UDP
client = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)

client.settimeout(10) # esperar um segundo para estabelecer conexão, senão fechar conexão

try:
    while True:
        msg = input("Mensagem: ") + "\nMensagem: "
        # iniciar escuta UDP pelo terminal com "nc -lvup 4466" (-u de UDP)
        # método sendto() é a combinação do connect com o send, pq não tem a confirmação como TCP
        client.sendto(msg.encode(), ("127.0.0.1", 4466))
        
        # usar recvfrom() para receber dados, pq não tem conexão como TCP
        # a resposta é um uma tupla (mensagem_em_bytes (endereço, porta))
        data, sender = client.recvfrom(1024)
        print(f"{sender[0]} na porta {sender[1]}: {data.decode()}")

        if data.decode() == "sair\n":
            break

except Exception as error:
    print("Erro na conexão.")
    print(error)